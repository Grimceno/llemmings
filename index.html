<!DOCTYPE html>
<html>
<head>
    <title>Lemmings Game</title>
    <style type="text/css">
        canvas {
            border: 1px solid black;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/noisejs/0.7.6/noise.min.js"></script>


</head>
<body>
    <canvas id="canvas" width="960" height="960"></canvas>
   

<script type="text/javascript">
/*
Using plain javascript and canvas, let's create a level that looks and act like the game Lemmings. 
Specifics are:
- randomly generated textures using some noise function, the most important here is that it looks smooth and colorful
- randomly generated map using some noise function - the map should be drawn on a 960x960 canvas - it should be easy to do collision detection against the generated map.
- we want to draw the map
- need to implement all the types of lemmings (blocker, bomber, floater etc)
- we also want to make sure the lemmings automatically move and collide on the map, we want one of each type spawned on the map at start

Instead of giving me the implementation to everything right away, generate prompts I can give to you in 
portions to eventually get a full implemention. We have to do it this way because of the context window size. 
After each time you replied to a prompt, you should tell me what I should ask from you next. Also tell me what code I would need to include, if any, to get an answer.


---------------------
Like the game Lemmings, I want to procedurally generate a random map of platforms which the lemmings walk on.
The platforms are made of dirt, background color is black, here and there there should be water.
Also come up with a solution to efficiently do collision detection between lemmings and the map.

The map should be drawn on a canvas using plain javascript. Give me only code, no explanation other than comments in the code.


*/
// Set up canvas and tile size
const canvas = document.getElementById("canvas");
const blockWidth = 40;
const blockHeight = 40;
canvas.width = 800;
canvas.height = 600;

// Generate random platform tiles
const ctx = canvas.getContext('2d');
ctx.fillStyle = "gray";
for (let y = 0; y < canvas.height; y += blockHeight) {
    for (let x = 0; x < canvas.width; x += blockWidth) {
        const isSolid = Math.random() > 0.5;
        if (isSolid) {
            ctx.fillRect(x, y, blockWidth, blockHeight);
        }
    }
}

// Collision detection function
function checkCollision(lemmingX, lemmingY) {
    const tileX = Math.floor(lemmingX / blockWidth);
    const tileY = Math.floor(lemmingY / blockHeight);
    
    // Check adjacent tiles for collision
    const leftTile = (tileX - 1 >= 0) ? ctx.getImageData((tileX - 1) * blockWidth, tileY * blockHeight, blockWidth, blockHeight).data : null;
    const rightTile = (tileX + 1 < canvas.width / blockWidth) ? ctx.getImageData((tileX + 1) * blockWidth, tileY * blockHeight, blockWidth, blockHeight).data : null;
    const topTile = (tileY - 1 >= 0) ? ctx.getImageData(tileX * blockWidth, (tileY - 1) * blockHeight, blockWidth, blockHeight).data : null;
    const bottomTile = (tileY + 1 < canvas.height / blockHeight) ? ctx.getImageData(tileX * blockWidth, (tileY + 1) * blockHeight, blockWidth, blockHeight).data : null;

    // Determine collision direction
    const collision = {left: false, right: false, top: false, bottom: false};
    if (leftTile && leftTile[3] === 255) {
        collision.left = true;
    }
    if (rightTile && rightTile[3] === 255) {
        collision.right = true;
    }
    if (topTile && topTile[3] === 255) {
        collision.top = true;
    }
    if (bottomTile && bottomTile[3] === 255) {
        collision.bottom = true;
    }
    return collision;
}

// Example usage of collision detection function
let lemmingX = 50;
let lemmingY = 50;
const velocityX = 5;
const velocityY = 0;

function update() {
    // Move lemming based on velocity
    lemmingX += velocityX;
    lemmingY += velocityY;
    
    // Check for collision and adjust position accordingly
    const collision = checkCollision(lemmingX, lemmingY);
    if (collision.left) {
        lemmingX += Math.ceil(Math.abs(lemmingX % blockWidth));
        velocityX *= -1;
    }
    if (collision.right) {
        lemmingX -= Math.ceil(Math.abs((lemmingX + blockWidth) % blockWidth));
        velocityX *= -1;
    }
    if (collision.top) {
        lemmingY += Math.ceil(Math.abs(lemmingY % blockHeight));
        velocityY *= -1;
    }
    if (collision.bottom) {
        lemmingY -= Math.ceil(Math.abs((lemmingY + blockHeight) % blockHeight));
        velocityY *= -1;
    }

    // Draw lemming on canvas
    // ctx.fillStyle = "green";
    // ctx.fillRect(lemmingX, lemm 
  // Update lemmings
  // ...

  // Check collisions with platforms
  // ...
}

function render() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  drawPlatforms();
  // Draw lemmings
  // ...
}

function gameLoop() {
  update();
  render();

  requestAnimationFrame 

</script>

</body>
</html>
