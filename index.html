<!DOCTYPE html>
<html>
<head>
    <title>Lemmings Game</title>
    <style type="text/css">
        canvas {
            border: 1px solid black;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/noisejs/0.7.6/noise.min.js"></script>


</head>
<body>
    <canvas id="canvas" width="960" height="960"></canvas>
   

<script type="text/javascript">
/*
Using plain javascript and canvas, let's create a level that looks and act like the game Lemmings. 
Specifics are:
- randomly generated textures using some noise function, the most important here is that it looks smooth and colorful
- randomly generated map using some noise function - the map should be drawn on a 960x960 canvas - it should be easy to do collision detection against the generated map.
- we want to draw the map
- need to implement all the types of lemmings (blocker, bomber, floater etc)
- we also want to make sure the lemmings automatically move and collide on the map, we want one of each type spawned on the map at start

Instead of giving me the implementation to everything right away, generate prompts I can give to you in 
portions to eventually get a full implemention. We have to do it this way because of the context window size. 
After each time you replied to a prompt, you should tell me what I should ask from you next. Also tell me what code I would need to include, if any, to get an answer.
*/

const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

//set up the canvas
canvas.width = 960;
canvas.height = 960;
document.body.appendChild(canvas);

let octaves = 2; // Number of layers of noise (higher this value, more details in terrain)
let scale = 0.02; // Determines how much zoomed in our noise is turned out to be, same as below
let persistence = 0.99; // Determines how much each layer contributes to final image, same as below

let mapArray = [];

// Fill map array with Perlin noise values using octave method
// Fill map array with Perlin noise values using octave method
function generateMap(xOffset, yOffset) {
  const terrainTypes = [
    { threshold: 0,   terrain: 'water' },
    { threshold: 0.4, terrain: 'grass' },
    { threshold: 0.7, terrain: 'dirt' },
    { threshold: 1,   terrain: 'mountain' }
  ];
  
  for (let x = 0; x < canvas.width; x++) {
    mapArray[x] = [];
    for (let y = 0; y < canvas.height; y++) {
      let noiseVal = 0;
      
      for (let i = 0; i < octaves; i++) { 
        let frequency = Math.pow(2, i);
        let amplitude = Math.pow(persistence, i);
        const val = noise((x + xOffset) * scale * frequency, (y + yOffset) * scale * frequency);
        noiseVal += val * amplitude; 
      }
      
      let terrainType = 'water';
      for (let t = 0; t < terrainTypes.length; ++t) {
        const { threshold, terrain } = terrainTypes[t];
        if (noiseVal > threshold) {
          terrainType = terrain;
        } else {
          break;
        }
      }
      mapArray[x][y] = terrainType;
    }
  }
}


// Function for generating a noise value based on x and y positions using Perlin noise algorithm 
function noise(x, y) {
    let n = Math.sin(x + y * 57) * 43758.5453123;
    return n - Math.floor(n);
}

generateMap(0, 0);
console.log(mapArray);
const TILE_SIZE = 16; // Change this to adjust the size of each tile

function drawMap(map) {
  for (let y = 0; y < map.length; y++) {
    for (let x = 0; x < map[y].length; x++) {
      const tileX = x * TILE_SIZE;
      const tileY = y * TILE_SIZE;

      switch (map[y][x]) {
        case 'grass':
          ctx.fillStyle = '#8bc34a'; // green
          break;
        case 'dirt':
          ctx.fillStyle = '#795548'; // brown
          break;
        case 'water':
          ctx.fillStyle = '#0000ff'; // blue
          break;
        case 'mountain':
          ctx.fillStyle = '#888888'; // gray
          break;
        // add cases for other terrain types as needed
      }

      ctx.fillRect(tileX, tileY, TILE_SIZE, TILE_SIZE);
    }
  }
}

drawMap(mapArray);


</script>

</body>
</html>
